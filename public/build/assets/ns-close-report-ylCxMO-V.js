import{b as c,d,h}from"./bootstrap-DT6nawEL.js";import{c as y,e as b}from"./components-CD4Rf5dL.js";import{_ as a,n as f}from"./currency-B1QCtbGi.js";import{N as u}from"./ns-prompt-popup-DaSUNmqq.js";import{j as g}from"./join-array-H-ZxDgvP.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as v,o as w,c as C,a as e,f as _,n as D,t as l,i as U}from"./runtime-core.esm-bundler-Bzup5G8m.js";import"./chart-XFVd3zf7.js";import"./ns-avatar-image--GgTfTV1.js";const L={name:"ns-close-report",data(){return{closeReport:"",startDateField:{name:"start_date",type:"datetime",value:ns.date.moment.startOf("day").format()},endDateField:{name:"end_date",type:"datetime",value:ns.date.moment.endOf("day").format()},result:[],isLoading:!1,users:[],ns:window.ns,summary:{},selectedUser:"",selectedCategory:"",reportType:{label:a("Report Type"),name:"reportType",type:"select",value:"categories_report",options:[{label:a("Categories Detailed"),value:"categories_report"},{label:a("Categories Summary"),value:"categories_summary"},{label:a("Products"),value:"products_report"}],description:a("Allow you to choose the report type.")},filterUser:{label:a("Filter User"),name:"filterUser",type:"select",required:"required",value:"",options:[],description:a("Allow you to choose the report type.")},filterCategory:{label:a("Filter By Category"),name:"filterCategory",type:"multiselect",value:"",options:[],description:a("Allow you to choose the category.")},field:{type:"datetimepicker",value:"2021-02-07",name:"date"}}},components:{nsDatepicker:y,nsDateTimePicker:b},computed:{},methods:{__:a,nsCurrency:f,joinArray:g,printCloseReport(){this.$htmlToPaper("close-report")},async openSettings(){try{const i=await new Promise((t,s)=>{Popup.show(u,{...this.reportType,resolve:t,reject:s})});this.reportType.value=i,this.result=[],this.loadReport()}catch(i){console.log({exception:i})}},async openUserFiltering(){try{this.isLoading=!0;const i=await new Promise((s,n)=>{c.get("/api/cash-registers").subscribe({next:o=>{this.users=o,this.isLoading=!1,this.filterUser.options=[...this.users.map(r=>({label:r.name,value:r.id}))],Popup.show(u,{...this.filterUser,resolve:s,reject:n})},error:o=>{this.isLoading=!1,d.error(a("No user was found for proceeding the filtering.")),n(o)}})}),t=this.users.filter(s=>s.id===i);if(t.length>0){let s=t[0];this.selectedUser=`${s.name} ${s.description?"("+s.description+")":""}`,this.filterUser.value=i,this.result=[],this.loadReport()}}catch(i){console.log({exception:i})}},async openCategoryFiltering(){try{let i=[];this.isLoading=!0;const t=await new Promise((s,n)=>{c.get("/api/categories").subscribe({next:o=>{this.isLoading=!1,i=o,this.filterCategory.options=[...o.map(r=>({label:r.name,value:r.id}))],Popup.show(u,{...this.filterCategory,resolve:s,reject:n})},error:o=>{this.isLoading=!1,d.error(a("No category was found for proceeding the filtering.")),n(o)}})});if(t.length>0){let s=i.filter(n=>t.includes(n.id)).map(n=>n.name);this.selectedCategory=this.joinArray(s),this.filterCategory.value=t}else this.selectedCategory="",this.filterCategory.value=[];this.result=[],this.loadReport()}catch(i){console.log(i)}},getType(i){const t=this.reportType.options.filter(s=>s.value===i);return t.length>0?t[0].label:a("Unknown")},loadReport(){if(this.startDate===null||this.endDate===null)return d.error(a("Unable to proceed. Select a correct time range.")).subscribe();if(console.log(this.filterUser.value),this.filterUser.value==null||this.filterUser.value=="")return d.error(a("Seleccione una caja primero.")).subscribe();const i=h(this.startDate);if(h(this.endDate).isBefore(i))return d.error(a("Unable to proceed. The current time range is not valid.")).subscribe();this.isLoading=!0,c.post("/api/reports/close-report",{startDate:this.startDateField.value,endDate:this.endDateField.value,type:this.reportType.value,user_id:this.filterUser.value,categories_id:this.filterCategory.value}).subscribe({next:s=>{this.isLoading=!1,this.result=s.result,this.summary=s.summary},error:s=>{this.isLoading=!1,d.error(s.message).subscribe()}})},computeTotal(i,t){return i.length>0?i.map(s=>parseFloat(s[t])).reduce((s,n)=>s+n):0}},props:["storeLogo","storeName"],mounted(){}},T={id:"report-section",class:"px-4"},F={class:"flex -mx-2"},k={class:"px-2"},R={class:"px-2"},N={class:"px-2"},P={class:"pl-2"},S={class:"flex -mx-2"},j={class:"px-2"},B={class:"pl-2"},A={class:"px-2"},M={class:"pl-2"},V={id:"close-report",class:"anim-duration-500 fade-in-entrance"},H={class:"flex w-full"},O={class:"my-4 flex justify-between w-full"},q={class:"text-secondary"},z=["innerHTML"],E={class:"pb-1 border-b border-dashed"},I={class:"pb-1 border-b border-dashed"},G=["src","alt"],J={class:"-mx-4 flex md:flex-row flex-col"},K={class:"w-full md:w-1/2 px-4"},Q={class:"shadow rounded my-4 ns-box"},W={class:"border-b ns-box-body"},X={class:"table ns-table w-full"},Y={class:"text-primary"},Z={class:""},$={class:"p-2 border text-right border-success-primary"},ee={class:""},te={class:"p-2 border text-right border-success-primary"},se={class:""},re={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},oe={class:"p-2 border text-right border-error-primary"},ie={class:""},le={class:"p-2 border text-right border-error-primary"},ae={class:""},ne={class:"p-2 border text-right border-error-primary"},de={class:""},ce={width:"200",class:"font-semibold p-2 border text-left bg-success-secondary border-success-secondary text-white"},ue={class:"p-2 border text-right border-success-primary"},pe={class:""},me={width:"200",class:"font-semibold p-2 border text-left bg-info-secondary border-info-secondary text-white"},he={class:"p-2 border text-right border-info-primary"};function _e(i,t,s,n,o,r){const p=v("ns-date-time-picker");return w(),C("div",T,[e("div",F,[e("div",k,[_(p,{field:o.startDateField},null,8,["field"])]),e("div",R,[_(p,{field:o.endDateField},null,8,["field"])]),e("div",N,[e("button",{onClick:t[0]||(t[0]=m=>r.loadReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[e("i",{class:D([o.isLoading?"animate-spin":"","las la-sync-alt text-xl"])},null,2),e("span",P,l(r.__("Load")),1)])])]),e("div",S,[e("div",j,[e("button",{onClick:t[1]||(t[1]=m=>r.printCloseReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[t[3]||(t[3]=e("i",{class:"las la-print text-xl"},null,-1)),e("span",B,l(r.__("Print")),1)])]),e("div",A,[e("button",{onClick:t[2]||(t[2]=m=>r.openUserFiltering()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[t[4]||(t[4]=e("i",{class:"las la-filter text-xl"},null,-1)),e("span",M,l(r.__("Por Caja"))+" : "+l(o.selectedUser),1)])])]),e("div",V,[e("div",H,[e("div",O,[e("div",q,[e("ul",null,[e("li",{class:"pb-1 border-b border-dashed",innerHTML:r.__("Range : {date1} â€” {date2}").replace("{date1}",o.startDateField.value).replace("{date2}",o.endDateField.value)},null,8,z),e("li",E,l(r.__("Document : Close Report")),1),e("li",I,l(r.__("By : {user}").replace("{user}",o.ns.user.username)),1)])]),e("div",null,[e("img",{class:"w-24",src:s.storeLogo,alt:s.storeName},null,8,G)])])]),e("div",null,[e("div",J,[e("div",K,[e("div",Q,[e("div",W,[e("table",X,[e("tbody",Y,[e("tr",Z,[t[5]||(t[5]=e("td",{width:"200",class:"font-semibold p-2 border text-left bg-success-secondary border-success-primary text-white"},l("Cierre anterior"),-1)),e("td",$,l(r.nsCurrency(o.summary.lastClose)),1)]),e("tr",ee,[t[6]||(t[6]=e("td",{width:"200",class:"font-semibold p-2 border text-left bg-success-secondary border-success-primary text-white"},l("Venta total"),-1)),e("td",te,l(r.nsCurrency(o.summary.totalSale)),1)]),e("tr",se,[e("td",re,l(r.__("Sales Discounts")),1),e("td",oe,l(r.nsCurrency(o.summary.sales_discounts)),1)]),e("tr",ie,[t[7]||(t[7]=e("td",{width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},l("Devoluciones"),-1)),e("td",le,l(r.nsCurrency(o.summary.refund)),1)]),e("tr",ae,[t[8]||(t[8]=e("td",{width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-secondary text-white"},l("Nota debito"),-1)),e("td",ne,l(r.nsCurrency(o.summary.cashOut)),1)]),e("tr",de,[e("td",ce,l(r.__("Nota credito")),1),e("td",ue,l(r.nsCurrency(o.summary.cashIn)),1)]),e("tr",pe,[e("td",me,l(r.__("Total en caja")),1),e("td",he,l(r.nsCurrency(o.summary.totalRegister)),1)])])])])])]),t[9]||(t[9]=e("div",{class:"w-full md:w-1/2 px-4"},null,-1))])]),t[10]||(t[10]=U(" //reports table "))])])}const Ue=x(L,[["render",_e]]);export{Ue as default};
